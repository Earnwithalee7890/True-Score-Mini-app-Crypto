{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Dell/.gemini/antigravity/scratch/v0-task-to-cash/app/api/neynar/user/route.ts"],"sourcesContent":["import { type NextRequest, NextResponse } from \"next/server\"\r\n\r\nexport async function GET(request: NextRequest) {\r\n  const searchParams = request.nextUrl.searchParams\r\n  const fid = searchParams.get(\"fid\")\r\n\r\n  if (!fid) {\r\n    return NextResponse.json({ error: \"FID is required\" }, { status: 400 })\r\n  }\r\n\r\n  const apiKey = process.env.NEYNAR_API_KEY\r\n\r\n  if (!apiKey) {\r\n    // Return mock data if no API key\r\n    return NextResponse.json({\r\n      fid: Number.parseInt(fid),\r\n      username: \"demo_user\",\r\n      displayName: \"Demo User\",\r\n      pfpUrl: \"/profile-avatar-crypto-user.jpg\",\r\n      score: 75,\r\n      reputation: \"neutral\" as const,\r\n      followers: 1234,\r\n      following: 567,\r\n      casts: 0,\r\n      replies: 0,\r\n      verifiedAddresses: [],\r\n    })\r\n  }\r\n\r\n  try {\r\n    const userResponse = await fetch(`https://api.neynar.com/v2/farcaster/user/bulk?fids=${fid}`, {\r\n      headers: {\r\n        accept: \"application/json\",\r\n        \"x-api-key\": apiKey,\r\n      },\r\n    })\r\n\r\n    if (!userResponse.ok) {\r\n      throw new Error(\"Failed to fetch user from Neynar\")\r\n    }\r\n\r\n    const userData = await userResponse.json()\r\n    const user = userData.users?.[0]\r\n\r\n    if (!user) {\r\n      return NextResponse.json({ error: \"User not found\" }, { status: 404 })\r\n    }\r\n\r\n    const score = user.experimental?.neynar_user_score ?? 0\r\n    const scorePercent = Math.round(score * 100)\r\n\r\n    let reputation: \"safe\" | \"neutral\" | \"risky\" | \"spammy\" = \"neutral\"\r\n    if (scorePercent >= 80) reputation = \"safe\"\r\n    else if (scorePercent >= 50) reputation = \"neutral\"\r\n    else if (scorePercent >= 25) reputation = \"risky\"\r\n    else reputation = \"spammy\"\r\n\r\n    // Fetch user's casts to count total casts and replies\r\n    let totalCasts = 0\r\n    let totalReplies = 0\r\n\r\n    try {\r\n      const castsResponse = await fetch(\r\n        `https://api.neynar.com/v2/farcaster/feed/user/${fid}?limit=50`,\r\n        {\r\n          headers: {\r\n            accept: \"application/json\",\r\n            \"x-api-key\": apiKey,\r\n          },\r\n        }\r\n      )\r\n\r\n      if (castsResponse.ok) {\r\n        const castsData = await castsResponse.json()\r\n        const casts = castsData.casts || []\r\n\r\n        // Count casts and replies\r\n        casts.forEach((cast: any) => {\r\n          if (cast.parent_hash || cast.parent_url) {\r\n            totalReplies++\r\n          } else {\r\n            totalCasts++\r\n          }\r\n        })\r\n      }\r\n    } catch (err) {\r\n      console.error(\"Error fetching casts:\", err)\r\n      // Continue with 0 counts if casts fetch fails\r\n    }\r\n\r\n    // Fetch Talent Protocol data\r\n    const eth_addresses = user.verified_addresses?.eth_addresses ?? []\r\n    let talentData = null\r\n    try {\r\n      const { getTalentProtocolData } = await import(\"@/lib/talent\")\r\n      talentData = await getTalentProtocolData(Number.parseInt(fid), eth_addresses, user.username)\r\n      console.log(`[TALENT_DEBUG] FID ${fid} (@${user.username}):`, JSON.stringify(talentData))\r\n    } catch (err) {\r\n      console.error(\"Error fetching Talent Protocol data:\", err)\r\n    }\r\n\r\n    console.log('[DEBUG] Returned Talent Data:', JSON.stringify(talentData))\r\n    return NextResponse.json({\r\n      fid: user.fid,\r\n      username: user.username,\r\n      displayName: user.display_name,\r\n      pfpUrl: user.pfp_url,\r\n      score: scorePercent,\r\n      reputation,\r\n      followers: user.follower_count ?? 0,\r\n      following: user.following_count ?? 0,\r\n      casts: totalCasts,\r\n      replies: totalReplies,\r\n      verifiedAddresses: user.verified_addresses?.eth_addresses ?? [],\r\n      builderScore: talentData?.builder_score ?? 0,\r\n      creatorScore: talentData?.creator_score ?? 0,\r\n      farcasterRevenue: talentData?.farcaster_revenue ?? 0,\r\n      isHuman: talentData?.human_checkmark,\r\n      isVerified: talentData?.verified,\r\n      talentHandle: talentData?.handle\r\n    })\r\n  } catch (error) {\r\n    console.error(\"Neynar API error:\", error)\r\n    return NextResponse.json({ error: \"Failed to fetch user data\" }, { status: 500 })\r\n  }\r\n}\r\n"],"names":[],"mappings":"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"}}]
}